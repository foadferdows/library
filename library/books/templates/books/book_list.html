{% load humanize %}
<!doctype html>
<html lang="fa" dir="ltl">
<head>
  <meta charset="utf-8">
  <title>فهرست کتاب‌ها</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    a.my-link:visited { color: #a78bfa; }  
    a.my-link:active  { opacity:.7 }

    :root{
      --bg:#0f172a;       /* slate-900 */
      --card:#111827;     /* gray-900 */
      --muted:#94a3b8;    /* slate-400 */
      --text:#e5e7eb;     /* gray-200 */
      --accent:#22d3ee;   /* cyan-400 */
      --accent-2:#a78bfa; /* violet-400 */
      --border:#1f2937;   /* gray-800 */
      --danger:#ef4444;   /* red-500 */
      --ok:#10b981;       /* emerald-500 */
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#0b1022);
      color:var(--text); font-family:IRANSans, Vazirmatn, Segoe UI, system-ui, sans-serif;
      line-height:1.9; padding:24px;
    }
    .container{max-width:1100px;margin:auto}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin:8px 0 16px}
    .topbar h1{font-size:1.4rem;margin:0}
    .topbar .meta{color:var(--muted);font-size:.95rem}
    .actions a.btn{
      display:inline-block;padding:.5rem .9rem;border-radius:.7rem;text-decoration:none;
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#0b1022; font-weight:700;
    }
    .card{
      background:rgba(17,24,39,.6); backdrop-filter: blur(6px);
      border:1px solid var(--border); border-radius:16px; padding:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px}
    thead th{
      text-align:left; font-weight:700; font-size:.92rem; letter-spacing:.2px;
      background:rgba(31,41,55,.7); padding:12px; border-bottom:1px solid var(--border)
    }
    tbody td{padding:12px;border-bottom:1px solid var(--border); vertical-align:middle}
    tbody tr:hover{background:rgba(2,6,23,.45)}
    .title{font-weight:700}
    .author a{color:var(--accent);text-decoration:none}
    .badge{
      display:inline-block;padding:.15rem .5rem;border-radius:.5rem;
      background:rgba(167,139,250,.15);border:1px solid rgba(167,139,250,.35);color:var(--accent-2);
      font-size:.78rem; font-weight:600
    }
    .price{white-space:nowrap}
    .muted{color:var(--muted)}
    .row-actions a{color:var(--accent);text-decoration:none;margin-left:8px}
    .row-actions a.danger{color:var(--danger)}
    .empty{
      text-align:center;padding:28px;color:var(--muted)
    }
    nav.pager{
      display:flex;gap:8px;align-items:center;justify-content:center;margin:18px 0 6px
    }
    nav.pager a, nav.pager span.badge{
      padding:.4rem .7rem;border:1px solid var(--border);border-radius:.6rem;text-decoration:none;color:var(--text)
    }
    nav.pager a:hover{background:rgba(31,41,55,.7)}
    .fav{color:#fbbf24;text-decoration:none} /* amber star */
    @media (max-width:760px){
      thead{display:none}
      table, tbody, tr, td{display:block;width:100%}
      tbody td{display:flex;justify-content:space-between;gap:12px}
      tbody td::before{content:attr(data-label);color:var(--muted)}
      .row-actions{justify-content:flex-start}
    }
    .search-center{
      display:flex; align-items:center; gap:8px; justify-content:center;
      margin:0 16px; flex:1; max-width:480px;
    }
    .search-center input{
      flex:1; min-width:220px;
      background:rgba(17,24,39,.5); border:1px solid var(--border); color:var(--text);
      padding:.6rem .8rem; border-radius:.7rem;
    }
    .search-center button{
      padding:.55rem .9rem; border-radius:.7rem; border:1px solid var(--border);
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#0b1022; font-weight:700; cursor:pointer
    }
    .search-center .clear{
      display:inline-block; padding:.5rem .7rem; border-radius:.6rem; text-decoration:none;
      border:1px solid var(--border); color:var(--text); background:transparent;
    }
    @media (max-width:760px){
      .topbar{flex-direction:column; align-items:stretch; gap:10px}
      .search-center{order:3; width:100%; max-width:none}
    }
    .fav { color:#94a3b8; text-decoration:none } /* پیش‌فرض */
    .fav.on { color:#fbbf24; font-weight:700 }
    .msg-success{ border-color:#065f46 !important; background:rgba(16,185,129,.08); color:#a7f3d0 }
    .msg-info   { border-color:#1e40af !important; background:rgba(59,130,246,.08); color:#bfdbfe }
    .msg-warning{ border-color:#92400e !important; background:rgba(245,158,11,.08); color:#fde68a }
    .msg-error  { border-color:#7f1d1d !important; background:rgba(239,68,68,.08); color:#fecaca }
    
    
  </style>
</head>
<body>
 <div class="container">

  <div class="topbar">
    <div>
      <h1>‌Books list</h1>
      <div class="meta">
        count — {{ page_obj.paginator.count|intcomma }} | 
        page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </div>
    </div>
    <form method="get" class="search-center" role="search" aria-label="Search books">
      <input type="text" name="q" value="{{ request.GET.q }}" placeholder="search by book title or author or category">
      <button type="submit">SEARCH</button>
      {% if request.GET.q %}
        <a href="{% url 'books:book_list' %}" class="clear">✕</a>
      {% endif %}
    </form>
    <div class="actions">
      <a class="btn" href="{% url 'books:book_create' %}">add new book</a>
    </div> 
    {% comment %} <div class="actions">
      <a class="btn" href="{% url 'books:my_favorites' %}">my favs</a>
    </div>  {% endcomment %}
    {% if request.resolver_match.url_name == 'my_favorites' %}
  <div class="actions">
    <a class="btn active" href="{% url 'books:book_list' %}">all books</a>
  </div>
{% else %}
  <div class="actions">
    <a class="btn" href="{% url 'books:my_favorites' %}">my favs</a>
  </div>
{% endif %}
  </div>   

  {% if messages %}
  <div class="card" style="margin-bottom:12px">
    {% for message in messages %}
      <div class="msg msg-{{ message.tags|default:'info' }}" style="
        margin:6px 0; padding:10px; border-radius:8px;
        border:1px solid var(--border);">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

  <div class="card">
    <table role="grid" aria-label="Books">
      <thead>
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Category</th>
          <th>Price</th>
          <th>Created Date</th>
          <th style="width:230px">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for b in books %}
          <tr>
            <td class="title" data-label="Title">
              {{ b.title }}
              {% if b.description %}<div class="muted" style="font-size:.88rem">{{ b.description|truncatechars:90 }}</div>{% endif %}
            </td>

            <td class="author" data-label="Authors">
              {% if b.author %}
                <a href="{% url 'books:author_detail' b.author.pk %}">{{ b.author.name }}</a>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            <td data-label="Category">
              {% if b.category %}
                <span class="badge">{{ b.get_category_display }}</span>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            <td class="price" data-label="Price">
              {% if b.price %}{{ b.price|floatformat:0|intcomma }}{% else %}<span class="muted">—</span>{% endif %}
            </td>

            <td data-label="Created Date">
              {{ b.published_date|default:"—" }}
            </td>

            <td class="row-actions" data-label="Action">
              <a href="{% url 'books:book_update' b.pk %}">edit</a>
              |
              <a class="danger" href="{% url 'books:book_delete' b.pk %}">Delete</a>
              {% if user.is_authenticated %}
                |
                <a class="fav {% if b.is_fav %}on{% endif %}"
                  href="{% url 'books:toggle_favorite' b.pk %}"
                  title="{% if b.is_fav %}remove from favs{% else %}added to favs{% endif %}">
                  {% if b.is_fav %}★{% else %}☆{% endif %}
                </a>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="empty">
              noting founded.
              {% comment %} <div style="margin-top:8px">
                <a href="{% url 'books:book_create' %}" class="btn">+ اولین کتاب را اضافه کن</a>
              </div> {% endcomment %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <nav class="pager" aria-label="pagination">

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Next ▶</a>
      {% endif %}
      <span class="badge">Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}">◀ Previous</a>
      {% endif %}

    </nav>
  </div>

</div>
</body>
</html>
